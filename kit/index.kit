<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Canker disease management options decision tool</title>
<meta name=viewport content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="css/all.css" />
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
</head>

<body id="page">

<!-- @import header -->

<section class="content-wrap">

<fieldset>
<!-- @import ../markdown/compiled/instructions.html -->
</fieldset>

<form action="" id="theform">

	<label><strong>Vineyard region: </strong><select name="region">
		<option value="cc">Central Coast</option>
		<option value="ns">Napa Sonoma</option>
		<option value="nc">Northern California</option>
		<option value="nsj">Northern San Joaquin</option>
		<option value="ssj">Southern San Joaquin</option>
	</select>

	<h3>Figure parameters</h3>
	<label><input type="checkbox" name="figuregen" checked="checked" />Generate figure</label>

	<fieldset class="figure">

		<h4>Specify figure options</h5>

		<p><a href="variable-definitions.html">Glossary of variable definitions</a></p>

		<h5>Display output as: <i class="fa fa-question-circle"></i></h5>
			<label><input type="radio" name="figuredisplay" value="netreturns" checked />Net returns <span class="show-for-medium-up">(thousands of $ per acre)</span></label>
			<label><input type="radio" name="figuredisplay" value="yield" />Yield <span class="show-for-medium-up">(tons per acre)</span></label>

		<h5>Aggregate output:</h5>
			<label><input type="radio" name="aggregatefig" value="cumulatively" checked="checked" />Cumulatively</label>
			<label><input type="radio" name="aggregatefig" value="annually" />Annually</label>
		
		<h4>Specify management scenario</h4>

		<h5>Select the management practices to consider:</h5>
			<label><input type="radio" name="practicefig" value="dp" />Delayed pruning</label>
			<label><input type="radio" name="practicefig" value="hp" />Hand-painted TopsinM</label>
			<label><input type="radio" name="practicefig" value="dbp" />Double pruning</label>

		<h5>Select anticipated efficacy:</h5>
			<label><input type="radio" name="efficacyfig" value="25" />25%</label>
			<label><input type="radio" name="efficacyfig" value="50" />50%</label>
			<label><input type="radio" name="efficacyfig" value="75" />75%</label>

	</fieldset>

	<h3>Table parameters</h3>
	<label><input type="checkbox" name="tablegen" checked="checked" />Generate table (functional for delayed pruning, 25% efficac, assumes NSJ region)</label>

	<fieldset class="table management">
		
		<h4>(1/2) Specify management scenario </h4>

		<h5>Select the management practices to consider (restricted to delayed pruning right now):</h5>
			<label><input type="checkbox" name="practicetable" value="dp" checked="checked" />Delayed pruning</label>
			<label><input type="checkbox" name="practicetable" value="hp" disabled="disabled" />Hand-painted TopsinM</label>
			<label><input type="checkbox" name="practicetable" value="dbp" disabled="disabled" />Double pruning</label>
		<h5>Select anticipated efficacy (restricted to 25% so far):</h5>
			<label><input type="checkbox" name="efficacytable" value="25" checked="checked" />25%</label>
			<label><input type="checkbox" name="efficacytable" value="50" disabled="disabled" />50%</label>
			<label><input type="checkbox" name="efficacytable" value="75" disabled="disabled" />75%</label>

		<h5>Select year of practice adoption (select multiple to compare):</h5>
			<label><input type="checkbox" name="adoptiontable" value="3" />Year 3</label>
			<label><input type="checkbox" name="adoptiontable" value="5" />Year 5</label>
			<label><input type="checkbox" name="adoptiontable" value="10" />Year 10</label>

		<h5>Choose output parameters</h5>
			<label><input type="checkbox" name="outputtable" value="dcnr" />Discounted cumulative net returns</label><br />
			<label><input type="checkbox" name="outputtable" value="aanr" />Annual average net returns</label><br />
			<label><input type="checkbox" name="outputtable" value="lpy" />Last profitable year</label><br />
			<label><input type="checkbox" name="outputtable" value="bea" />Breakeven age</label><br />

	</fieldset>

	<input type="submit" value="Display returns to this practice" />

</form>

<section class="results"></section>

</section>

<script type="text/javascript">
$(document).ready(function() {
	$('input[name=figuredisplay]').change(function() {
		if (this.value == 'netreturns') {
			$('input[name=aggregatefig]').each(function() {
				$(this).prop('disabled', false).prop('checked', false);
			});
			$('input[name=aggregatefig][value=cumulatively]').prop('checked', true);
			$('input[name=practicefig]').each(function() {
				$(this).prop('disabled', false);
			});
		}
		else if (this.value == 'yield') {
			$('input[name=practicefig]').each(function() {
				$(this).prop('disabled', true);
			});
			$('input[name=aggregatefig][value=annually]').prop('checked', true).prop('disabled', true);
			$('input[name=aggregatefig][value=cumulatively').prop('disabled', true);
		}
	});

	var figurestate = new Boolean(true);
	var tablestate = new Boolean(true);

	$('input[name=figuregen]').change(function() {
		figurestate = $(this).prop('checked');
		$('fieldset.figure').each(function() {
			$(this).prop('disabled', !figurestate);
		});
	});
	$('input[name=tablegen]').change(function() {
		tablestate = $(this).prop('checked');
		$('fieldset.table').each(function() {
			$(this).prop('disabled', !tablestate);
		});
	});
	
	$('#theform').submit(function(e) {
		e.preventDefault();
		var figoutput;
		switch ( $('input[name=figuredisplay]:checked').val() ) {
			case 'yield':
				figoutput = 'yield';
				break;
			case 'netreturns':
				figoutput = $('input[name=practicefig]:checked').val();
				break;
		};
		var fig = '<img src="images/figures/' + $('select[name=region]').val() + '-' + figoutput + $('input[name=efficacyfig]:checked').val() + '.png" alt="Graphical result" />';
		var nsj = [];
		var nsjdp253 = [];
		nsjdp253['dcnr'] = '13,797.00';
		nsjdp253['aanr'] = '551.88';
		nsjdp253['lpy'] = '14';
		nsjdp253['bea'] = '3';
		var nsjdp255 = [];
		nsjdp255['dcnr'] = '11,187.00';
		nsjdp255['aanr'] = '447.48';
		nsjdp255['lpy'] = '14';
		nsjdp255['bea'] = '5';
		var nsjdp2510 = [];
		nsjdp2510['dcnr'] = '4,772.00';
		nsjdp2510['aanr'] = '190.88';
		nsjdp2510['lpy'] = '12';
		nsjdp2510['bea'] = '10';
		nsj = [nsjdp253, nsjdp255, nsjdp2510];
		var tableparams = [];
		var inputs = [];
		var outputs = [];
		var inputkeys = [];
		inputkeys = ['dbp', 'hp', 'dp', '25', '50', '75', '3', '5', '10'];
		for (var inputindex in inputkeys) {
			inputs[inputkeys[inputindex]] = false;
		};
		var outputkeys = [];
		outputkeys = ['dcnr', 'aanr', 'lpy', 'bea'];
		for (var outputindex in outputkeys) {
			outputs[outputkeys[outputindex]] = false;
		};
		tableparams['inputs'] = inputs;
		tableparams['outputs'] = outputs;
		$('input[name$=table]:checked').each(function() {
			var element = $(this).attr('value');
			if ( $(this).attr('name') == 'outputtable' )
				tableparams.outputs[element] = true;
			else
				tableparams.inputs[element] = true;
		});
		var tablelabels = '';
		var tablerowsdefined = [];
		var k=0;
		var n=0;
		var the_input_keys = Object.keys(tableparams.inputs);
		for (var rowcount in tableparams.inputs ) {
			var the_key = the_input_keys[k];
			console.log(the_key);
			if ( the_key == '3' || the_key == '5' || the_key == '10' && tableparams.inputs[the_key] == true ) {
				tablerowsdefined[n] = the_key;
				console.log('tablerowsdefined: ' + n);
				n++;
			}
			k++;
		}
		var tablerowvalues = [];

		var j=0;
		var the_output_keys = Object.keys(tableparams.outputs);
		console.log(the_output_keys);
		for (var rowcount in tablerowsdefined) {
			var i=0;
			console.log('rowcount: ' + j);
			var the_year = tablerowsdefined[j];
			tablerowvalues[j]='';
			console.log('the_year = ' + the_year);
			if (tableparams.inputs[the_year] == true) {
				tablerowvalues[j] = '<td>' + tablerowsdefined[j] + '</td>';
				console.log(tablerowvalues[j]);
				for (var param in tableparams.outputs) {
					var the_key = the_output_keys[i];
					if (tableparams.outputs[the_key] == true ) {
						tablerowvalues[j] += '<td>' + nsj[j][the_key] + '</td>';
					}
					i++;
				}
			}
			j++;
		};
		var i=0;
		for ( var param in tableparams.outputs ) {
			var the_key = the_output_keys[i];
			if ( tableparams.outputs[the_key] == true ) {
				var fullLabel = '';
				switch (the_key) {
					case 'dcnr':
						fullLabel = 'DCNR';
						break;
					case 'aanr':
						fullLabel = 'Annual average net returns';
						break;
					case 'lpy':
						fullLabel = 'Last profitable year';
						break;
					case 'bea':
						fullLabel = 'Breakeven age';
						break;
				};
				tablelabels += '<td>' + fullLabel + '</td>'
			}
			i++;
		};
		tablelabels = '<tr><td>Region</td><td>Efficacy</td><td>Year of adoption</td>' + tablelabels + '</tr>';
		
		var tablerows = '';
		var m=0;
		for (var rowcount in tablerowvalues) {
			var the_year = tablerowsdefined[m];
			if (tableparams.inputs[the_year] == true) {
				tablerows += '<tr><td>Northern San Joaquin</td><td>25%</td>' + tablerowvalues[m] + '</tr>';
			}
			console.log('tablerowvalues: ' + m + ': ' + tablerowvalues[m]);
			m++;
		}

		var table = '<h3>Output table</h3><table>' + tablelabels + tablerows + '</table>';
		var assumptions = '<h3>Parameter Values Used in Calculations</h3><table><tr><td>Vineyard Lifespan</td><td>25 years</td></tr><tr><td>Discount Rate</td><td>5%</td></tr><tr><td>Base Dollar</td><td>2013</td></tr><tr><td>Yield per acre</td><td>Shown in figure</td></tr><tr><td>5-year Average Price per ton</td><td>$XXX</td></tr><tr><td>Cultivar</td><td>Cabernet Sauvignon (?)</td></tr><tr><td>Additional Cost from Delayed Pruning per acre</td><td>$0</td></tr><tr><td>Additional Cost from Double Pruning per acre</td><td>$XX</td></tr><tr><td>Additional Cost from Handpainting TopsinM per acre</td><td>$XXX</td></tr><tr><td>Cultural Cost - Year 0 - Establishing Vineyard</td><td>$XX,XXX</td></tr><tr><td>Cultural Cost - Year 1 - Establishing Vineyard</td><td>$XX,XXX</td></tr><tr><td>Cultural Cost - Year 2 - Establishing Vineyard</td><td>$XX,XXX</td></tr><tr><td>Cultural Cost - Year 3+ Established Vineyard</td><td>$XX,XXX</td></tr></table>';
		var results = assumptions + '<p><a href="#page">Adjust parameters</a></p>';
		if (tablestate == true)
			results = table + results;
		if (figurestate == true)
			results = fig + results;
		$('.results').html(results);
	});
})
</script>

</body>
</html>