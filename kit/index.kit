<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Canker disease management options decision tool</title>
<meta name=viewport content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="css/all.css" />
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
</head>

<body>

<!-- @import header -->

<fieldset>
<!-- @import ../markdown/compiled/instructions.html -->
</fieldset>

<form action="" id="theform">

	<select name="region">
		<option value="cc">Central Coast</option>
		<option value="ns">Napa Sonoma</option>
		<option value="nc">Northern California</option>
		<option value="nsj">Northern San Joaquin</option>
		<option value="ssj">Southern San Joaquin</option>
	</select>

	<h3>Figure parameters</h3>
	<label><input type="checkbox" name="genfigure" checked="checked" />Generate figure</label>

	<fieldset class="figure">

		<h4>Specify figure options</h5>

		<p><a href="variable-definitions.html">Glossary of variable definitions</a></p>

		<h5>Display output as: <i class="fa fa-question-circle"></i></h5>
			<label><input type="radio" name="figuredisplay" value="netreturns" checked />Net returns <span class="show-for-medium-up">(thousands of $ per acre)</span></label>
			<label><input type="radio" name="figuredisplay" value="yield" />Yield <span class="show-for-medium-up">(tons per acre)</span></label>

		<h5>Aggregate output:</h5>
			<label><input type="radio" name="aggregatefig" value="cumulatively" checked="checked" />Cumulatively</label>
			<label><input type="radio" name="aggregatefig" value="annually" />Annually</label>
		
		<h4>Specify management scenario</h4>

		<h5>Select the management practices to consider:</h5>
			<label><input type="radio" name="practicefig" value="dp" />Delayed pruning</label>
			<label><input type="radio" name="practicefig" value="hp" />Hand-painted TopsinM</label>
			<label><input type="radio" name="practicefig" value="dbp" />Double pruning</label>

		<h5>Select anticipated efficacy:</h5>
			<label><input type="radio" name="efficacyfig" value="25" />25%</label>
			<label><input type="radio" name="efficacyfig" value="50" />50%</label>
			<label><input type="radio" name="efficacyfig" value="75" />75%</label>

	</fieldset>

	<h3>Table parameters</h3>
	<label><input type="checkbox" name="tablegen" />Generate table (work in progress, mostly nonfunctional)</label>

	<fieldset class="table management">
		
		<h4>(1/2) Specify management scenario </h4>

		<h5>Select the management practices to consider:</h5>
			<label><input type="checkbox" name="practicetable" value="dbp" disabled="disabled" />Delayed pruning</label>
			<label><input type="checkbox" name="practicetable" value="hp" disabled="disabled" />Hand-painted TopsinM</label>
			<label><input type="checkbox" name="practicetable" value="dp" />Double pruning</label>
		<h5>Select anticipated efficacy (select multiple to compare):</h5>
			<label><input type="checkbox" name="efficacytable" value="25" />25%</label>
			<label><input type="checkbox" name="efficacytable" value="50" disabled="disabled" />50%</label>
			<label><input type="checkbox" name="efficacytable" value="75" disabled="disabled" />75%</label>

		<h5>Select year of practice adoption (select multiple to compare):</h5>
			<label><input type="checkbox" name="adoptiontable" value="y3" />Year 3</label>
			<label><input type="checkbox" name="adoptiontable" value="y5" />Year 5</label>
			<label><input type="checkbox" name="adoptiontable" value="y10" />Year 10</label>

		<h5>Choose output parameters</h5>
			<label><input type="checkbox" name="outputtable" value="dcnr" />Discounted cumulative net returns</label><br />
			<label><input type="checkbox" name="outputtable" value="annual-avg-net-returns" />Annual average net returns</label><br />
			<label><input type="checkbox" name="outputtable" value="last-profitable-year" />Last profitable year</label><br />
			<label><input type="checkbox" name="outputtable" value="breakeven-age" />Breakeven age</label><br />

	</fieldset>

	<input type="submit" value="Display returns to this practice" />

</form>

<section class="results"></section>

<script type="text/javascript">
$(document).ready(function() {
	console.log('ready');
	$('input[name=figuredisplay]').change(function() {
		console.log('change');
		if (this.value == 'netreturns') {
			console.log('netreturns');
			$('input[name=aggregatefig]').each(function() {
				$(this).prop('disabled', false).prop('checked', false);
			});
			$('input[name=aggregatefig][value=cumulatively]').prop('checked', true);
			$('input[name=practicefig]').each(function() {
				$(this).prop('disabled', false);
			});
		}
		else if (this.value == 'yield') {
			console.log('yield');
			$('input[name=practicefig]').each(function() {
				$(this).prop('disabled', true);
			});
			$('input[name=aggregatefig][value=annually]').prop('checked', true).prop('disabled', true);
			$('input[name=aggregatefig][value=cumulatively').prop('disabled', true);
		}
	});
	$('input[name=genfigure]').change(function() {
		var figurestate = $(this).prop('checked');
		$('fieldset.figure').each(function() {
			$(this).prop('disabled', !figurestate);
		});
	});
	$('input[name=tablegen]').change(function() {
		var tablestate = $(this).prop('checked');
		$('fieldset.table').each(function() {
			$(this).prop('disabled', !tablestate);
		});
	});
	
	$('#theform').submit(function(e) {
		e.preventDefault();
		var figoutput;
		console.log($('input[name=figuredisplay]:checked').val());
		switch ( $('input[name=figuredisplay]:checked').val() ) {
			case 'yield':
				console.log('case: yield.');
				figoutput = 'yield';
				break;
			case 'netreturns':
				console.log('case: netreturns.');
				console.log($('input[name=practicefig]:checked').val());
				figoutput = $('input[name=practicefig]:checked').val();
				break;
		};
		var fig = '<img src="images/figures/' + $('select[name=region]').val() + '-' + figoutput + $('input[name=efficacyfig]:checked').val() + '.png" alt="Graphical result" />';
		var nsjdp25 = {
			"Northern San Joaquin": [{
				"dp25-3": [{
					"dcnr": "13,797.00",
					"annual-avg-net-returns": "551.88",
					"last-profitable-year": "14",
					"breakeven-age": "3"
				}],
				"dp25-5": [{
					"dcnr": "11,187.00",
					"annual-avg-net-returns": "447.48",
					"last-profitable-year": "14", 
					"breakeven-age": "5"
				}],
				"dp25-10": [{
					"dcnr": "4,772.00",
					"annual-avg-net-returns": "190.88",
					"last-profitable-year": "12",
					"breakeven-age": "10"
				}]
			}]
		};
		var tableparams = [{
			"inputs": {
				"dbp": false,
				"hp": false,
				"dp": false,
				"25": false,
				"50": false,
				"75": false,
				"y3": false,
				"y5": false,
				"y10": false
			},
			"outputs": {
				"dcnr": false,
				"annual-avg-net-returns": false,
				"last-profitable-year": false,
				"breakeven-age": false
			}
		}];
		$('input[name$=table]:checked').each(function() {
			var element = $(this).attr('value');
			if ( $(this).attr('name') == 'outputtable' )
				tableparams[0].outputs[element] = true;
			else
				tableparams[0].inputs[element] = true;
		});
		console.log(tableparams);
		var tablelabels;
		/*for (i=0; i < tableparams[0].length; i++) {

		}*/
		var assumptions = '<h3>Parameter Values Used in Calculations</h3><table><tr><td>Vineyard Lifespan</td><td>25 years</td></tr><tr><td>Discount Rate</td><td>5%</td></tr><tr><td>Base Dollar</td><td>2013</td></tr><tr><td>Yield per acre</td><td>Shown in figure</td></tr><tr><td>5-year Average Price per ton</td><td>$XXX</td></tr><tr><td>Cultivar</td><td>Cabernet Sauvignon (?)</td></tr><tr><td>Additional Cost from Delayed Pruning per acre</td><td>$0</td></tr><tr><td>Additional Cost from Double Pruning per acre</td><td>$XX</td></tr><tr><td>Additional Cost from Handpainting TopsinM per acre</td><td>$XXX</td></tr><tr><td>Cultural Cost - Year 0 - Establishing Vineyard</td><td>$XX,XXX</td></tr><tr><td>Cultural Cost - Year 1 - Establishing Vineyard</td><td>$XX,XXX</td></tr><tr><td>Cultural Cost - Year 2 - Establishing Vineyard</td><td>$XX,XXX</td></tr><tr><td>Cultural Cost - Year 3+ Established Vineyard</td><td>$XX,XXX</td></tr></table>';
		var results = fig + assumptions;
		console.log(results);
		$('.results').html(results);
	});
})
</script>

</body>
</html>